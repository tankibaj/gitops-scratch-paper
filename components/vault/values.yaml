# Vault Helm Chart Value Overrides
global:
  enabled: true
  tlsDisable: true

injector:
  enabled: true
  # Use the Vault K8s Image https://github.com/hashicorp/vault-k8s/
#  image:
#    repository: "hashicorp/vault-k8s"
#    tag: "0.9.0"

  resources:
    requests:
      memory: 256Mi
      cpu: 250m
    limits:
      memory: 256Mi
      cpu: 250m
  affinity: ""


server:
  resources:
    requests:
      memory: 256Mi
      cpu: 200m
    limits:
      memory: 512Mi
      cpu: 400m

  ingress:
    enabled: true
    ingressClassName: "public"
    hosts:
      - host: vault.local.naim.run
        paths: [ ]

  readinessProbe:
    enabled: true
    path: "/v1/sys/health?standbyok=true&sealedcode=204&uninitcode=204"

  affinity: ""

  dataStorage:
    enabled: false

  auditStorage:
    enabled: false

#  # AWS KMS Auto Unseal secret - https://developer.hashicorp.com/vault/docs/configuration/seal/awskms
#  extraSecretEnvironmentVars:
#    - envName: AWS_SECRET_ACCESS_KEY
#      secretName: aws-kms
#      secretKey: AWS_SECRET_ACCESS_KEY
#    - envName: AWS_ACCESS_KEY_ID
#      secretName: aws-kms
#      secretKey: AWS_ACCESS_KEY_ID


#  standalone:
#    enabled: true
#    config: |
#      ui = true
#
#      listener "tcp" {
#        tls_disable = 1
#        address = "[::]:8200"
#        cluster_address = "[::]:8201"
#      }
#      storage "consul" {
#        path = "vault"
#        address = "HOST_IP:8500"
#      }
#
#      service_registration "kubernetes" {}

  ha:
    enabled: true
    replicas: 3
    raft:
      enabled: false

    config: |
      ui = true

      listener "tcp" {
        tls_disable = 1
        address = "[::]:8200"
        cluster_address = "[::]:8201"
      }
      storage "consul" {
        path = "vault"
        address = "consul-server.consul.svc.cluster.local:8500"
      }

      service_registration "kubernetes" {}


#  # -- Production recommended configuration
#  ha:
#    config: |
#      ui = true
#
#      listener "tcp" {
#        tls_disable = 1
#        address = "[::]:8200"
#        cluster_address = "[::]:8201"
#        telemetry {
#          unauthenticated_metrics_access = "true"
#        }
#      }
#
#      storage "postgresql" {
#        connection_url = "postgres://user:password@postgres.local.naim.run:5432/vault_db?sslmode=disable"
#        table = "vault_kv_store"
#        ha_enabled = "true"
#        ha_table = "vault_ha_locks"
#      }
#
#      service_registration "kubernetes" {}
#
#      seal "awskms" {
#        region     = "eu-central-1"
#        kms_key_id = "e4shkkhsdd-96867-4c61-5654-0b546jj46455af"
#      }
#
#      telemetry {
#        prometheus_retention_time = "12h",
#        disable_hostname = true
#      }